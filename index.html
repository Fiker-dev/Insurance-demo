<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Aubrey‚Äôs Admin Assistant ‚Äî Demo</title>
  <meta name="description" content="Gina, the AI assistant for insurers. Organize leads, renewals, follow-ups, and notes ‚Äî fast." />
  <link rel="icon" href="favicon.ico" type="image/x-icon" />

  <style>
    :root{
      --bg:#0e1320; --panel:#11182a; --card:#141d33; --ink:#e9eef7; --muted:#9fb0c8;
      --brand:#59c4ff; --brand-2:#8bd1ff; --good:#22c55e; --warn:#f5b40a; --bad:#ef4444;
      --ring:0 0 0 2px rgba(89,196,255,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--ink); background:linear-gradient(180deg,#0b1020 0%, #0c152c 100%);
    }

    /* Layout */
    header{position:sticky;top:0;z-index:20;background:#0d1426bd;backdrop-filter:blur(8px);
      border-bottom:1px solid rgba(159,176,200,.18); display:flex;gap:16px;align-items:center;
      padding:14px 18px;}
    .logo-badge{width:40px;height:40px;border-radius:12px; display:grid;place-items:center;
      background:linear-gradient(150deg,var(--brand),#1da3ff); box-shadow:0 8px 20px rgba(29,163,255,.25);}
    .title{font-weight:800;letter-spacing:.2px}
    .subhead{color:var(--muted);font-size:12px;margin-top:2px}
    .wrap{max-width:1200px;margin:0 auto;padding:16px}
    .grid{display:grid;grid-template-columns:280px 1fr 360px;gap:16px}
    @media (max-width:1100px){ .grid{grid-template-columns:1fr} }

    /* Cards / panels */
    .card{background:var(--card);border:1px solid rgba(159,176,200,.15);border-radius:14px;box-shadow:0 8px 30px rgba(0,0,0,.25);}
    .panel{background:var(--panel);border:1px solid rgba(159,176,200,.15);border-radius:14px;box-shadow:0 8px 30px rgba(0,0,0,.25);}
    .section{padding:16px}
    h2{margin:0 0 10px 0;font-size:16px;letter-spacing:.2px}
    .kpis{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
    @media (max-width:700px){ .kpis{grid-template-columns:repeat(2,1fr)} }
    .kpi{padding:14px;border-radius:12px; background:#101a31;border:1px solid rgba(159,176,200,.1);
      transition:transform .15s ease; }
    .kpi:hover{transform:translateY(-2px)}
    .kpi .lbl{color:var(--muted);font-size:12px}
    .kpi .val{font-size:24px;font-weight:800;letter-spacing:.2px;margin-top:6px}
    .kpi.good .val{color:var(--good)} .kpi.warn .val{color:var(--warn)}

    /* Tables */
    .table{width:100%;border-collapse:collapse}
    .table th,.table td{padding:10px 8px;border-bottom:1px solid rgba(159,176,200,.1);text-align:left;font-size:14px}
    .table th{color:var(--muted);font-weight:700}

    /* Form */
    .form{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    .form .full{grid-column:1/-1}
    label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
    input,select,textarea{
      width:100%;padding:12px 12px;border-radius:12px;background:#0e1730;color:var(--ink);
      border:1px solid rgba(159,176,200,.22);outline:none;font-size:14px;transition:.15s border-color,.15s box-shadow;
    }
    input:focus,select:focus,textarea:focus{box-shadow:var(--ring);border-color:transparent}
    .actions{display:flex;gap:10px;flex-wrap:wrap}
    .btn{
      border:1px solid rgba(159,176,200,.25);background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,.03));
      color:var(--ink);padding:12px 14px;border-radius:12px;font-weight:700;cursor:pointer;transition:.15s transform,.15s border-color;
    }
    .btn:hover{transform:translateY(-1px)}
    .btn.brand{border-color:transparent;background:linear-gradient(180deg,var(--brand),#1da3ff);color:#081018;box-shadow:0 10px 25px rgba(29,163,255,.25)}
    .btn.ghost{background:transparent}
    .note{color:var(--muted);font-size:12px}

    /* Chat (Gina) */
    .chat{display:flex;flex-direction:column;height:100%}
    .chat-box{flex:1;overflow:auto;padding:14px;display:flex;flex-direction:column;gap:10px}
    .msg{max-width:85%;padding:10px 12px;border-radius:12px;white-space:pre-wrap}
    .me{align-self:flex-end;background:#173159;border:1px solid rgba(159,176,200,.18)}
    .gina{align-self:flex-start;background:#0e1730;border:1px solid rgba(159,176,200,.18)}
    .chat-input{display:flex;gap:8px;padding:12px;border-top:1px solid rgba(159,176,200,.12)}
    .chat-input input{flex:1}
    .fade-in{animation:fade .35s ease}
    @keyframes fade{from{opacity:.0;transform:translateY(4px)}to{opacity:1;transform:none}}

    footer{color:var(--muted);text-align:center;padding:14px;font-size:12px}
  </style>
</head>
<body>
  <header>
    <div class="logo-badge" aria-hidden="true">üíß</div>
    <div>
      <div class="title">Aubrey‚Äôs Admin Assistant</div>
      <div class="subhead">‚ÄúGina‚Äù ‚Äî organizes renewals, follow-ups, leads, and notes</div>
    </div>
    <div style="margin-left:auto;display:flex;gap:8px;">
      <button class="btn ghost" id="demoBtn">Load Demo Data</button>
      <button class="btn brand" id="exportBtn">Export CSV</button>
    </div>
  </header>

  <div class="wrap">
    <div class="grid">
      <!-- LEFT: Dashboard -->
      <section class="panel section">
        <h2>Today</h2>
        <div class="kpis" id="kpis">
          <div class="kpi"><div class="lbl">New Leads</div><div class="val" id="kpiLeads">0</div></div>
          <div class="kpi warn"><div class="lbl">Follow-ups Due</div><div class="val" id="kpiFups">0</div></div>
          <div class="kpi"><div class="lbl">Renewals (7d)</div><div class="val" id="kpiRen">0</div></div>
          <div class="kpi good"><div class="lbl">Pipeline (Won)</div><div class="val" id="kpiWon">0</div></div>
        </div>

        <div style="height:12px"></div>
        <div class="card section fade-in">
          <h2>Upcoming Renewals</h2>
          <table class="table" id="tblRenewals">
            <thead><tr><th>Client</th><th>Policy</th><th>Renewal</th><th>Status</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>

        <div style="height:12px"></div>
        <div class="card section fade-in">
          <h2>Follow-ups</h2>
          <table class="table" id="tblFollowups">
            <thead><tr><th>Client</th><th>Reason</th><th>Due</th><th>Contact</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <!-- CENTER: Quote Intake (bigger form) -->
      <section class="card section">
        <h2>New Quote (Internal)</h2>
        <div class="note">Filled by Aubrey or team during in-person meetings. Gina can auto-fill later via email/calendar integrations.</div>
        <div style="height:10px"></div>
        <form id="quoteForm" class="form">
          <div>
            <label>Full Name</label>
            <input id="f_name" placeholder="e.g., Sarah Ndlovu" required />
          </div>
          <div>
            <label>Phone</label>
            <input id="f_phone" placeholder="+27 ..." />
          </div>
          <div>
            <label>Email</label>
            <input id="f_email" type="email" placeholder="name@company.com" />
          </div>
          <div>
            <label>Policy Type</label>
            <select id="f_type">
              <option>Life</option><option>Auto</option><option>Home</option>
            </select>
          </div>
          <div>
            <label>Coverage Amount (ZAR)</label>
            <input id="f_cover" type="number" placeholder="e.g., 500000" />
          </div>
          <div>
            <label>Age</label>
            <input id="f_age" type="number" min="18" max="100" placeholder="e.g., 34" />
          </div>
          <div>
            <label>Smoker</label>
            <select id="f_smoker"><option>No</option><option>Yes</option></select>
          </div>
          <div>
            <label>Renewal Target</label>
            <input id="f_renewal" type="date" />
          </div>
          <div class="full">
            <label>Notes</label>
            <textarea id="f_notes" rows="3" placeholder="Meeting notes, special conditions..."></textarea>
          </div>
          <div class="actions full">
            <button type="button" class="btn" id="estimateBtn">Estimate Premium</button>
            <button type="submit" class="btn brand">Create Lead</button>
            <div class="note" id="formMsg"></div>
          </div>
        </form>

        <div style="height:12px"></div>
        <div class="card section fade-in">
          <h2>Leads & Quotes</h2>
          <table class="table" id="tblLeads">
            <thead><tr><th>Name</th><th>Policy</th><th>Est Premium</th><th>Status</th><th>Next Action</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <!-- RIGHT: Gina (Chat) + Notes -->
      <aside class="panel section chat">
        <h2>Chat with Gina</h2>
        <div class="note">Try: ‚Äúsummarize renewals this week‚Äù ‚Ä¢ ‚Äú3 renewal subject lines‚Äù ‚Ä¢ ‚Äúlog note: call Thabo 10am tomorrow‚Äù.</div>
        <div class="chat-box card" id="chatBox">
          <div class="msg gina fade-in">Hi, I‚Äôm Gina. I‚Äôll help you with renewals, follow-ups, quotes and notes. What do you need?</div>
        </div>
        <div class="chat-input">
          <input id="chatInput" placeholder="Ask Gina..." />
          <button class="btn brand" id="chatSend">Send</button>
        </div>

        <div style="height:12px"></div>
        <div class="card section">
          <h2>Notes & Reminders</h2>
          <div class="note">Say ‚Äúremind me tomorrow 09:00 to call Sarah‚Äù or add below. (Demo stores locally.)</div>
          <div class="actions" style="margin-top:8px">
            <input id="noteText" placeholder="Note or reminder..." />
            <button class="btn" id="addNoteBtn">Add</button>
          </div>
          <ul id="notesList" style="margin:10px 0 0 0;padding:0;list-style:none;"></ul>
        </div>
      </aside>
    </div>
  </div>

  <footer>¬© Luli Digital ‚Ä¢ Built for demo ‚Äî switch between mock/live seamlessly.</footer>

  <script>
    // ---------- CONFIG ----------
    const API_URL = "https://insurance-demo-one.vercel.app/api/chat"; // your Vercel endpoint
    const FORCE_MOCK = true; // set to false when your API billing is live

    // ---------- STATE ----------
    const state = {
      leads: [],
      renewals: [],
      followups: [],
      pipelineWon: 0,
      notes: JSON.parse(localStorage.getItem("aubrey_notes")||"[]")
    };

    // ---------- HELPERS ----------
    const $ = (id)=>document.getElementById(id);
    const fmtZAR = (n)=> n ? "R " + (Number(n)).toLocaleString() : "‚Äî";
    const fmtDate = (d)=> d ? new Date(d).toLocaleDateString() : "‚Äî";

    function estPremium({type, cover, age, smoker}){
      // simple demo calc
      const base = {Life: 0.0022, Auto: 0.0012, Home: 0.0009}[type] || 0.001;
      const ageFactor = Math.max(0.8, Math.min(1.6, (age? (age/40) : 1)));
      const smokeFactor = smoker==="Yes" ? 1.25 : 1.0;
      return Math.round((cover||0) * base * ageFactor * smokeFactor);
    }

    function toast(msg){ const el=$("formMsg"); el.textContent=msg; setTimeout(()=>el.textContent="", 3000); }

    function renderKpis(){
      $("kpiLeads").textContent = state.leads.length;
      $("kpiFups").textContent = state.followups.length;
      const soon = state.renewals.filter(r=> new Date(r.renewal) - new Date() <= 7*86400000);
      $("kpiRen").textContent = soon.length;
      $("kpiWon").textContent = state.pipelineWon;
    }

    function renderTable(id, rows){
      const tbody = document.querySelector(`#${id} tbody`);
      tbody.innerHTML = rows.map(r=>`<tr>${r.map(c=>`<td>${c}</td>`).join("")}</tr>`).join("");
    }

    function renderLists(){
      renderTable("tblRenewals",
        state.renewals
         .sort((a,b)=>new Date(a.renewal)-new Date(b.renewal))
         .map(r=>[r.name, r.policy, fmtDate(r.renewal), r.status||"‚Äî"]));

      renderTable("tblFollowups",
        state.followups
         .sort((a,b)=>new Date(a.due)-new Date(b.due))
         .map(f=>[f.name, f.reason, fmtDate(f.due), f.contact||"‚Äî"]));

      renderTable("tblLeads",
        state.leads
         .slice(-50)
         .reverse()
         .map(l=>[l.name, l.policyType, fmtZAR(l.premium), l.status, fmtDate(l.nextAction)]));
    }

    // ---------- DEMO DATA ----------
    function loadDemo(){
      state.leads = [
        {name:"Sarah Ndlovu", policyType:"Life", premium: 820, status:"New", nextAction:new Date()},
        {name:"Thabo Khumalo", policyType:"Auto", premium: 540, status:"Quoted", nextAction:new Date(Date.now()+86400000)},
        {name:"Naledi D.", policyType:"Home", premium: 460, status:"Won", nextAction:null}
      ];
      state.renewals = [
        {name:"Sarah Ndlovu", policy:"Life R500k", renewal:new Date(Date.now()+2*86400000), status:"Pending"},
        {name:"Thabo Khumalo", policy:"Auto ‚Äî Comprehensive", renewal:new Date(Date.now()+3*86400000), status:"Contacted"},
        {name:"Ayesha Patel", policy:"Home R1.2m", renewal:new Date(Date.now()+5*86400000), status:"Pending"}
      ];
      state.followups = [
        {name:"Naledi D.", reason:"Send revised quote", due:new Date(Date.now()+86400000), contact:"naledi@example.com"},
        {name:"Pierre L.", reason:"Request documents", due:new Date(Date.now()+2*86400000), contact:"+27 82 000 0000"}
      ];
      state.pipelineWon = 1;
      renderKpis(); renderLists();
      appendGina("Loaded demo data. Ask me: ‚Äòsummarize renewals this week‚Äô or ‚Äò3 renewal subject lines‚Äô.", true);
    }

    // ---------- CHAT / GINA ----------
    const chatBox = $("chatBox");
    function appendMe(msg){ const el=document.createElement("div"); el.className="msg me fade-in"; el.textContent=msg; chatBox.appendChild(el); chatBox.scrollTop=chatBox.scrollHeight; }
    function appendGina(msg, soft){ const el=document.createElement("div"); el.className="msg gina fade-in"; el.textContent=(soft?"": "Gina: ")+msg; chatBox.appendChild(el); chatBox.scrollTop=chatBox.scrollHeight; }
    function mockAnswer(q){
      const t=q.toLowerCase();
      if(t.includes("renewal") && (t.includes("week")||t.includes("today"))) {
        const soon = state.renewals.map(r=>`${r.name} ‚Äî ${fmtDate(r.renewal)} (${r.policy})`).join("\n");
        return soon ? `Upcoming renewals:\n${soon}` : "No renewals scheduled.";
      }
      if(t.includes("subject")||t.includes("email")){
        return "Quick Reminder: Renew Today\nYour Policy Renewal ‚Äî Stay Covered\nFriendly Nudge: Renew in Minutes";
      }
      if(t.startsWith("log note")||t.startsWith("add note")){
        const content = q.replace(/^log note:|^add note:/i,'').trim();
        if(content){ state.notes.push({text:content, at:new Date()}); persistNotes(); renderNotes(); return "Noted. I‚Äôll remind you during daily summary."; }
        return "What should I note?";
      }
      if(t.includes("follow-up")) {
        return state.followups.length ? state.followups.map(f=>`${f.name} ‚Äî ${f.reason} ‚Äî ${fmtDate(f.due)}`).join("\n") : "No follow-ups due.";
      }
      if(t.includes("quote")||t.includes("premium")){
        return "For quick premium estimate, fill the form (coverage, age, smoker) and click ‚ÄòEstimate Premium‚Äô.";
      }
      return "I can help with renewals, follow-ups, quotes, and notes. Try: ‚Äòsummarize renewals this week‚Äô or ‚Äòlog note: call Sarah 09:00 tomorrow‚Äô.";
    }

    async function askGina(q){
      if(FORCE_MOCK){ return mockAnswer(q); }
      try{
        const r = await fetch(API_URL,{
          method:"POST", headers:{"Content-Type":"application/json"},
          body: JSON.stringify({ message:q })
        });
        const data = await r.json();
        return data.reply || mockAnswer(q);
      }catch(e){ return mockAnswer(q); }
    }

    $("chatSend").addEventListener("click", async ()=>{
      const q = $("chatInput").value.trim(); if(!q) return;
      $("chatInput").value=""; appendMe(q);
      appendGina("‚Ä¶thinking");
      const ans = await askGina(q);
      const last = chatBox.querySelector(".gina:last-child"); last.textContent = ans;
    });

    // ---------- NOTES ----------
    function renderNotes(){
      const list=$("notesList"); list.innerHTML="";
      state.notes.slice().reverse().forEach((n,i)=>{
        const li=document.createElement("li");
        li.style.margin="8px 0"; li.style.fontSize="14px";
        li.textContent = `‚Ä¢ ${n.text}  ‚Äî  ${new Date(n.at).toLocaleString()}`;
        list.appendChild(li);
      });
      persistNotes();
    }
    function persistNotes(){ localStorage.setItem("aubrey_notes", JSON.stringify(state.notes)); }
    $("addNoteBtn").addEventListener("click", ()=>{
      const t=$("noteText").value.trim(); if(!t) return;
      state.notes.push({text:t, at:new Date()}); $("noteText").value=""; renderNotes();
    });

    // ---------- FORM ----------
    $("estimateBtn").addEventListener("click", ()=>{
      const data = collectForm();
      const p = estPremium(data);
      toast(`Estimated Premium: ${fmtZAR(p)}`);
    });

    $("quoteForm").addEventListener("submit",(e)=>{
      e.preventDefault();
      const d = collectForm();
      const premium = estPremium(d);
      state.leads.push({
        name:d.name, policyType:d.type, premium, status:"New",
        nextAction: new Date(Date.now()+2*86400000)
      });
      if(d.renewal){ state.renewals.push({name:d.name, policy:`${d.type} ${fmtZAR(d.cover)}`, renewal:d.renewal, status:"Pending"}); }
      renderKpis(); renderLists();
      e.target.reset();
      toast("Lead created. Gina can follow up from chat.");
    });

    function collectForm(){
      return {
        name:$("f_name").value.trim(),
        phone:$("f_phone").value.trim(),
        email:$("f_email").value.trim(),
        type:$("f_type").value,
        cover:Number($("f_cover").value || 0),
        age:Number($("f_age").value || 0),
        smoker:$("f_smoker").value,
        renewal:$("f_renewal").value ? new Date($("f_renewal").value) : null,
        notes:$("f_notes").value.trim()
      };
    }

    // ---------- EXPORT ----------
    $("exportBtn").addEventListener("click", ()=>{
      const rows = [["Name","Policy","Premium","Status","NextAction"]];
      state.leads.forEach(l=>rows.push([l.name,l.policyType,l.premium,l.status, l.nextAction? new Date(l.nextAction).toISOString().slice(0,10):""]));
      const csv = rows.map(r=>r.map(x=>`"${(x??"").toString().replace(/"/g,'""')}"`).join(",")).join("\n");
      const blob = new Blob([csv],{type:"text/csv;charset=utf-8;"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a"); a.href=url; a.download="leads.csv"; a.click();
      URL.revokeObjectURL(url);
    });

    // ---------- DEMO BUTTON ----------
    $("demoBtn").addEventListener("click", loadDemo);

    // init
    renderKpis(); renderLists(); renderNotes();
  </script>
</body>
</html>

